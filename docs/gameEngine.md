# Игровой движок
Вся логика игры выстроена на Canvas, AnimationFrame и TypeScript, которая реализуется в классе CanvasAPI.

### Переменные класса

|   Переменная    | Описание                                                                              |
| :-------------: | :------------------------------------------------------------------------------------ |
|   **context**   | Контекст полученные из canvas, переданного в конструктор класса                       |
| **squareWidth** | Ширину составляющего квадрата для любой фигуры в пикселях                             |
|   **animTime**  | Длительность анимации в милисекундах                                                  |
|     **width**   | Ширина canvas                                                                         |
|    **height**   | Высота canvas                                                                         |
|      **x**      | Текущая x координата активной фигуры                                                  |
|      **y**      | Текущая y координата активной фигуры                                                  |
|   **animId**    | ID текущей анимации                                                                   |
| **fieldMatrix** | Матрица всего поля, в которой указывается цвет определённой ячейки или его отсутствие |
| **shapeMatrix** | Матрица текущей фигуры                                                                |
|  **shapeColor** | Цвет текущей фигуры                                                                   |
|  **gameState**  | Состояние начала игры, true - начата, false - не начата                               |

### Методы класса

|       Метод      | Описание                                                                                                                                         |
| :--------------: | :----------------------------------------------------------------------------------------------------------------------------------------------- |
|   **startGame**  | Инициирует начало игры, создание бесконечного цикла, который генерирует случайную фигуру, запускает анимацию и устанавливает слушатели на клавиш |
| **setListeners** | Устанавливает все необходимые слушатели для клавиш                                                                                               |
|   **drawPiece**  | Отрисовывает составляющие квадрат для всех фигур. Принимает в себя цвет, координату X и координату Y на канвасе                                  |
|   **animation**  | Запускает анимацию изменения канваса. Принимает в себя время запуска анимации и длительность анимации                                            |
|  **drawObjects** | Выбирает случайную фигуру, которая будет, задаёт цвет и начальную матрицу для выбранной фигуры в соответстующие переменные и запускает анимацию  |
|   **drawShape**  | Отрисовывает фигуру на канвасе исходя из матрицы в переменной shapeMatrix. Принимает в себя X и Y координаты                                     |
| **rotateMatrix** | Поворачивает матрицу активной фигуры по часовой стрелке                                                                                          |
| **rotateObject** | Поворачивает активную фигуру на канвасе. Принимает в себя KeyboardEvent, который передаётся из функции setListeners                              |
|  **moveObject**  | Смещает активную фигуру на канвасе вправо или влево. Принимает в себя KeyboardEvent, который передаётся из функции setListeners                  |

Пример для инициализации начала игры:
``` typescript
import React, { useEffect } from 'react'
import CanvasAPI from '@/services/CanvasAPI'

const Canvas: React.FC = () => {
  const [api, setApi] = useState<CanvasAPI>()

  useEffect(() => {
    setApi(new CanvasAPI(document.querySelector('canvas') as HTMLCanvasElement))
  }, [])

  const startGame = () => {
    api?.startGame()
  }

  return (
    <>
      <canvas
        width="420"
        height="600"
        onClick={startGame}></canvas>
    </>
  )
}
```
**ВАЖНО**

Высота и ширина Canvas в вёртске должна быть кратна значению переменной squareWidth. В примере выше squareWidth равняется 30.             
